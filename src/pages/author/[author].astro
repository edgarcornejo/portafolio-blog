---
import Layout from "../../layouts/Layout.astro";
import { formatBlogPosts, slugify } from "../../js/utils";
import PostPreview from "../../components/PostPreview.astro";

export async function getStaticPaths() {
	const allPost = await Astro.glob("../publicaciones/*.md");
	const formattedPosts = formatBlogPosts(allPost);
	const allAuthors = [
		...new Set(
			formattedPosts.map((post: any) => post.frontmatter.author).flat(),
		),
	];
	return allAuthors.map((author) => {
		const authorPosts = formattedPosts.filter(
			(post: any) => post.frontmatter.author === author,
		);
		return {
			params: { author: slugify(author) },
			props: {
				authorName: author,
				posts: authorPosts,
			},
		};
	});
}

const { posts } = Astro.props;
---

<Layout title="Publicaciones de Edgar Cornejo">
	<main>
		<div class="wrapper-post">
			{posts.map((apost: any) => <PostPreview post={apost} />)}
		</div>
	</main>
</Layout>
