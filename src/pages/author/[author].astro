---
import Layout from "../../layouts/Layout.astro";
import "../../styles/layout.css";
import { formatBlogPosts, slugify } from "../../js/utils";
import PostPreview from "../../components/PostPreview.astro";

export async function getStaticPaths() {
    const allPost = await Astro.glob("../publicaciones/*.md");
    const formattedPosts = formatBlogPosts(allPost);
    const allAuthors = [
        ...new Set(
            formattedPosts.map((post) => post.frontmatter.author).flat(),
        ),
    ];
    return allAuthors.map((author) => {
        const authorPosts = formattedPosts.filter(
            (post) => post.frontmatter.author === author,
        );
        return {
            params: { author: slugify(author) },
            props: {
                authorName: author,
                posts: authorPosts,
            },
        };
    });
}

const { author } = Astro.params;
const { posts, authorName } = Astro.props;
---

<Layout title={authorName}>
    <div class="main-content">
        <header>
            <h1>Publicaciones de {authorName}</h1>
        </header>

        <main>
            <div class="wrapper-post">
                {posts.map((apost) => <PostPreview post={apost} />)}
            </div>
        </main>
    </div>
</Layout>
